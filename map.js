function Map() {};

Map.prototype = {
  map: {"layers": [{"adjacency_dct": {}, "type": "layer", "name": "main", "objects": [{"sprite_ref": "rail", "name": "39", "position": [480, 32], "frame": 0, "animated": false, "type": "proxy", "id": 39, "frame_time": 10}, {"sprite_ref": "rail", "name": "38", "position": [416, 64], "frame": 6, "animated": false, "type": "proxy", "id": 38, "frame_time": 10}, {"sprite_ref": "rail", "name": "40", "position": [544, 64], "frame": 5, "animated": false, "type": "proxy", "id": 40, "frame_time": 10}, {"sprite_ref": "rail", "name": "37", "position": [352, 96], "frame": 2, "animated": false, "type": "proxy", "id": 37, "frame_time": 10}, {"sprite_ref": "rail", "name": "42", "position": [608, 96], "frame": 3, "animated": false, "type": "proxy", "id": 42, "frame_time": 10}, {"sprite_ref": "rail", "name": "36", "position": [416, 128], "frame": 5, "animated": false, "type": "proxy", "id": 36, "frame_time": 10}, {"sprite_ref": "rail", "name": "41", "position": [544, 128], "frame": 2, "animated": false, "type": "proxy", "id": 41, "frame_time": 10}, {"sprite_ref": "rail", "name": "35", "position": [480, 160], "frame": 3, "animated": false, "type": "proxy", "id": 35, "frame_time": 10}, {"sprite_ref": "rail", "name": "18", "position": [608, 160], "frame": 3, "animated": false, "type": "proxy", "id": 18, "frame_time": 10}, {"sprite_ref": "rail", "name": "8", "position": [864, 160], "frame": 4, "animated": false, "type": "proxy", "id": 8, "frame_time": 10}, {"sprite_ref": "rail", "name": "32", "position": [416, 192], "frame": 2, "animated": false, "type": "proxy", "id": 32, "frame_time": 10}, {"sprite_ref": "rail", "name": "17", "position": [544, 192], "frame": 2, "animated": false, "type": "proxy", "id": 17, "frame_time": 10}, {"sprite_ref": "rail", "name": "5", "position": [800, 192], "frame": 4, "animated": false, "type": "proxy", "id": 5, "frame_time": 10}, {"sprite_ref": "rail", "name": "6", "position": [928, 192], "frame": 4, "animated": false, "type": "proxy", "id": 6, "frame_time": 10}, {"sprite_ref": "rail", "name": "31", "position": [480, 224], "frame": 3, "animated": false, "type": "proxy", "id": 31, "frame_time": 10}, {"sprite_ref": "rail", "name": "16", "position": [608, 224], "frame": 5, "animated": false, "type": "proxy", "id": 16, "frame_time": 10}, {"sprite_ref": "rail", "name": "10", "position": [736, 224], "frame": 0, "animated": false, "type": "proxy", "id": 10, "frame_time": 10}, {"sprite_ref": "rail", "name": "4", "position": [864, 224], "frame": 4, "animated": false, "type": "proxy", "id": 4, "frame_time": 10}, {"sprite_ref": "rail", "name": "9", "position": [992, 224], "frame": 4, "animated": false, "type": "proxy", "id": 9, "frame_time": 10}, {"sprite_ref": "rail", "name": "30", "position": [416, 256], "frame": 2, "animated": false, "type": "proxy", "id": 30, "frame_time": 10}, {"sprite_ref": "rail", "name": "15", "position": [672, 256], "frame": 1, "animated": false, "type": "proxy", "id": 15, "frame_time": 10}, {"sprite_ref": "rail", "name": "11", "position": [800, 256], "frame": 5, "animated": false, "type": "proxy", "id": 11, "frame_time": 10}, {"sprite_ref": "rail", "name": "7", "position": [928, 256], "frame": 4, "animated": false, "type": "proxy", "id": 7, "frame_time": 10}, {"sprite_ref": "rail", "name": "29", "position": [480, 288], "frame": 3, "animated": false, "type": "proxy", "id": 29, "frame_time": 10}, {"sprite_ref": "rail", "name": "12", "position": [864, 288], "frame": 5, "animated": false, "type": "proxy", "id": 12, "frame_time": 10}, {"sprite_ref": "rail", "name": "28", "position": [416, 320], "frame": 2, "animated": false, "type": "proxy", "id": 28, "frame_time": 10}, {"sprite_ref": "rail", "name": "13", "position": [928, 320], "frame": 5, "animated": false, "type": "proxy", "id": 13, "frame_time": 10}, {"sprite_ref": "rail", "name": "27", "position": [480, 352], "frame": 5, "animated": false, "type": "proxy", "id": 27, "frame_time": 10}, {"sprite_ref": "rail", "name": "14", "position": [992, 352], "frame": 3, "animated": false, "type": "proxy", "id": 14, "frame_time": 10}, {"sprite_ref": "rail", "name": "26", "position": [544, 384], "frame": 5, "animated": false, "type": "proxy", "id": 26, "frame_time": 10}, {"sprite_ref": "rail", "name": "23", "position": [672, 384], "frame": 0, "animated": false, "type": "proxy", "id": 23, "frame_time": 10}, {"sprite_ref": "rail", "name": "21", "position": [800, 384], "frame": 0, "animated": false, "type": "proxy", "id": 21, "frame_time": 10}, {"sprite_ref": "rail", "name": "19", "position": [928, 384], "frame": 6, "animated": false, "type": "proxy", "id": 19, "frame_time": 10}, {"sprite_ref": "rail", "name": "25", "position": [608, 416], "frame": 1, "animated": false, "type": "proxy", "id": 25, "frame_time": 10}, {"sprite_ref": "rail", "name": "22", "position": [736, 416], "frame": 1, "animated": false, "type": "proxy", "id": 22, "frame_time": 10}, {"sprite_ref": "rail", "name": "20", "position": [864, 416], "frame": 1, "animated": false, "type": "proxy", "id": 20, "frame_time": 10}]}, {"adjacency_dct": {"0": [1], "1": [2], "2": [3], "3": [4], "4": [5], "5": [6], "6": [13], "7": [8], "8": [9], "9": [10], "10": [11], "11": [12], "12": [0], "13": [7]}, "type": "layer", "name": "waypoints", "objects": [{"sprite_ref": "12", "name": "12", "position": [512, 224], "frame": 0, "animated": false, "type": "proxy", "id": 12, "frame_time": 10}, {"sprite_ref": "0", "name": "0", "position": [544, 224], "frame": 0, "animated": false, "type": "proxy", "id": 0, "frame_time": 10}, {"sprite_ref": "11", "name": "11", "position": [448, 256], "frame": 0, "animated": false, "type": "proxy", "id": 11, "frame_time": 10}, {"sprite_ref": "1", "name": "1", "position": [640, 256], "frame": 0, "animated": false, "type": "proxy", "id": 1, "frame_time": 10}, {"sprite_ref": "10", "name": "10", "position": [448, 288], "frame": 0, "animated": false, "type": "proxy", "id": 10, "frame_time": 10}, {"sprite_ref": "9", "name": "9", "position": [512, 320], "frame": 0, "animated": false, "type": "proxy", "id": 9, "frame_time": 10}, {"sprite_ref": "2", "name": "2", "position": [640, 384], "frame": 0, "animated": false, "type": "proxy", "id": 2, "frame_time": 10}, {"sprite_ref": "3", "name": "3", "position": [704, 416], "frame": 0, "animated": false, "type": "proxy", "id": 3, "frame_time": 10}, {"sprite_ref": "4", "name": "4", "position": [832, 416], "frame": 0, "animated": false, "type": "proxy", "id": 4, "frame_time": 10}, {"sprite_ref": "8", "name": "8", "position": [512, 512], "frame": 0, "animated": false, "type": "proxy", "id": 8, "frame_time": 10}, {"sprite_ref": "5", "name": "5", "position": [1024, 512], "frame": 0, "animated": false, "type": "proxy", "id": 5, "frame_time": 10}, {"sprite_ref": "6", "name": "6", "position": [1024, 544], "frame": 0, "animated": false, "type": "proxy", "id": 6, "frame_time": 10}, {"sprite_ref": "7", "name": "7", "position": [640, 576], "frame": 0, "animated": false, "type": "proxy", "id": 7, "frame_time": 10}, {"sprite_ref": "13", "name": "13", "position": [960, 576], "frame": 0, "animated": false, "type": "proxy", "id": 13, "frame_time": 10}]}], "grid_step": [32, 32], "map_size": [256, 256], "format": 1, "images": {"red_tank_0001.png": {"origin": [896, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0001.png"}, "straight_angle_rail_0003.png": {"origin": [0, 512], "type": "image", "dimensions": [128, 256], "name": "straight_angle_rail_0003.png"}, "straight_angle_rail_0001.png": {"origin": [256, 512], "type": "image", "dimensions": [128, 256], "name": "straight_angle_rail_0001.png"}, "red_tank_0005.png": {"origin": [384, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0005.png"}, "red_tank_0004.png": {"origin": [0, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0004.png"}, "red_tank_0006.png": {"origin": [768, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0006.png"}, "locomotive_0007.png": {"origin": [0, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0007.png"}, "locomotive_0004.png": {"origin": [384, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0004.png"}, "locomotive_0005.png": {"origin": [256, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0005.png"}, "clean_tile_0000.png": {"origin": [512, 512], "type": "image", "dimensions": [128, 256], "name": "clean_tile_0000.png"}, "straight_rail_0001.png": {"origin": [640, 512], "type": "image", "dimensions": [128, 256], "name": "straight_rail_0001.png"}, "straight_rail_0000.png": {"origin": [768, 512], "type": "image", "dimensions": [128, 256], "name": "straight_rail_0000.png"}, "red_tank_0003.png": {"origin": [640, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0003.png"}, "red_tank_0007.png": {"origin": [128, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0007.png"}, "locomotive_0006.png": {"origin": [128, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0006.png"}, "straight_angle_rail_0002.png": {"origin": [128, 512], "type": "image", "dimensions": [128, 256], "name": "straight_angle_rail_0002.png"}, "locomotive_0002.png": {"origin": [640, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0002.png"}, "straight_angle_rail_0000.png": {"origin": [384, 512], "type": "image", "dimensions": [128, 256], "name": "straight_angle_rail_0000.png"}, "red_tank_0000.png": {"origin": [512, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0000.png"}, "red_tank_0002.png": {"origin": [256, 768], "type": "image", "dimensions": [128, 128], "name": "red_tank_0002.png"}, "locomotive_0003.png": {"origin": [512, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0003.png"}, "locomotive_0000.png": {"origin": [896, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0000.png"}, "locomotive_0001.png": {"origin": [768, 896], "type": "image", "dimensions": [128, 128], "name": "locomotive_0001.png"}}, "type": "map", "sprites": {"steam_locomotive": {"type": "sprite", "name": "steam_locomotive", "image_refs": ["locomotive_0007.png", "locomotive_0006.png", "locomotive_0005.png", "locomotive_0004.png", "locomotive_0003.png", "locomotive_0002.png", "locomotive_0001.png", "locomotive_0000.png"]}, "rail": {"type": "sprite", "name": "rail", "image_refs": ["straight_angle_rail_0003.png", "straight_angle_rail_0002.png", "straight_angle_rail_0001.png", "straight_angle_rail_0000.png", "clean_tile_0000.png", "straight_rail_0001.png", "straight_rail_0000.png"]}, "red_tank_car": {"type": "sprite", "name": "red_tank_car", "image_refs": ["red_tank_0004.png", "red_tank_0007.png", "red_tank_0002.png", "red_tank_0005.png", "red_tank_0000.png", "red_tank_0003.png", "red_tank_0006.png", "red_tank_0001.png"]}}, "atlas_path": "media/tilesets/level_0.png"},
  
  atlas: null,
  images: {},
  sprites: {},
  layers: {},

  get_image_by_name: function(self, name) {
    if (name in self.images) {
      return self.images[name];
    }
    return null;
  },

  get_sprite_by_name: function(self, name) {
    if (name in self.sprites) {
      return self.sprites[name];
    }
    return null;
  },

  init: function(self) {
    self.atlas = new Image();
    self.atlas.onLoad=function() {
      console.log("atlas loaded");
    };
    self.atlas.src = self.map["atlas_path"];

    for (var i in self.map["images"]) {
      var image_json = self.map["images"][i];
      var image = new LImage();
      image.init(image, image_json);
      self.images[image.name] = image;
    }

    for (var s in self.map["sprites"]) {
      var sprite_json = self.map["sprites"][s];
      var sprite = new Sprite();
      sprite.init(sprite, sprite_json);
      self.sprites[sprite.name] = sprite;
    }

    for (var l in self.map["layers"]) {
      var layer_json = self.map["layers"][l];
      var layer = new Layer();
      layer.init(layer, layer_json);
      self.layers[layer.name] = layer;
    }
  },

  draw: function(self) {
    var layer = self.layers["main"];
    layer.draw(layer);
  }
};

var map = new Map();
